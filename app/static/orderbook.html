<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>ETHUSDT Order Book (Top 20 Levels)</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #888; padding: 8px; text-align: center; }
        th { background: #ddd; }
        caption { font-size: 1.5em; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ETHUSDT Order Book (Top 20 Levels)</h1>

    <h2>Asks</h2>
    <table id="asks-table">
        <tr><th>Price</th><th>Quantity</th></tr>
    </table>

    <h2>Bids</h2>
    <table id="bids-table">
        <tr><th>Price</th><th>Quantity</th></tr>
    </table>

    <script>
      // Функция рисует таблицу из массива rows
      function renderTable(rows, tableId) {
          const table = document.getElementById(tableId);
          table.innerHTML = '<tr><th>Price</th><th>Quantity</th></tr>';
          const slice = rows.slice(0, 20);
          slice.forEach(([price, qty]) => {
              const tr = document.createElement('tr');
              tr.innerHTML = `<td>${parseFloat(price).toFixed(2)}</td><td>${parseFloat(qty).toFixed(6)}</td>`;
              table.appendChild(tr);
          });
      }

      // Запрос стакана по HTTP и обновление таблиц
      async function fetchOrderbook() {
        try {
          const res = await fetch('/api/orderbook');
          if (!res.ok) throw new Error(res.statusText);
          const data = await res.json();
          const asks = data.asks || [];
          const bids = data.bids || [];

          // Asks: от самого дорогого вниз
          renderTable(asks.sort((a,b) => b[0] - a[0]), 'asks-table');
          // Bids: от самого дорогого вниз
          renderTable(bids.sort((a,b) => b[0] - a[0]), 'bids-table');
        } catch (err) {
          console.error('Fetch orderbook error', err);
        }
      }

      // Запускаем опрос раз в 100ms
      setInterval(fetchOrderbook, 100);
    </script>
</body>
</html>
